<h2><%=l(:label_register)%> <%=link_to l(:label_login_with_open_id_option), signin_url if Setting.openid? %></h2>

<%= labelled_form_for @user, :url => register_path do |f| %>
<%= error_messages_for 'user' %>

<div class="box tabular">
<% if @user.auth_source_id.nil? %>
<script type="text/javascript">
Event.observe(window,'load',
function fillData() {
		var val = "<%= cookies['ElastosID'] %>";
		var name = val.substring(val.indexOf("http://")+7,val.indexOf("."));
		document.getElementById("user_login").value= name;
		document.getElementById("user_login").readOnly=true;
		document.getElementById("user_password").value=name;
		document.getElementById("user_password_confirmation").value=name;
		document.getElementById("user_firstname").value=name;
		document.getElementById("user_lastname").value='-';
		document.getElementById("user_identity_url").value=val;
		document.getElementById("p1").style.display="none";
		document.getElementById("p2").style.display="none";

});
</script>
<% end %>

<p><%= f.text_field :firstname, :required => true %></p>
<p><%= f.text_field :lastname, :required => true %></p>
<p><%= f.text_field :mail, :required => true %></p>
<p><%= f.select :language, lang_options_for_select %></p>

<% if Setting.openid? %>
  <p><%= f.text_field :identity_url  %></p>
<% end %>

<% @user.custom_field_values.select {|v| v.editable? || v.required?}.each do |value| %>
  <p><%= custom_field_tag_with_label :user, value %></p>
<% end %>
</div>

<%= submit_tag l(:button_submit) %>
<% end %>
